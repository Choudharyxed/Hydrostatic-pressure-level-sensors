metadata:
  name: waterlevelsensor
  labels:
    nuclio.io/project-name: 2a68545e-5920-4272-a683-894f3c2c8aad
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-waterlevelsensor:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    waterlevel_Tigger:
      class: ""
      kind: mqtt
      url: "guest:guest@172.18.0.2:1883"
      attributes:
        subscriptions:
          - qos: 0
            topic: iot/waterlevel
  build:
    functionSourceCode: dmFyIGFtcXAgPSByZXF1aXJlKCJhbXFwbGliIik7DQoNCmZ1bmN0aW9uIHNlbmRfYWxlcnQobXNnKSB7DQogIHZhciBxID0gImlvdC9hbGVydHMiOw0KICBhbXFwDQogICAgLmNvbm5lY3QoImFtcXA6Ly9ndWVzdDpndWVzdEAxNzIuMTguMC4yOjU2NzIiKQ0KICAgIC50aGVuKGZ1bmN0aW9uIChjb25uKSB7DQogICAgICByZXR1cm4gY29ubg0KICAgICAgICAuY3JlYXRlQ2hhbm5lbCgpDQogICAgICAgIC50aGVuKGZ1bmN0aW9uIChjaCkgew0KICAgICAgICAgIHZhciBvayA9IGNoLmFzc2VydFF1ZXVlKHEsIHsgZHVyYWJsZTogZmFsc2UgfSk7DQogICAgICAgICAgcmV0dXJuIG9rLnRoZW4oZnVuY3Rpb24gKF9xb2spIHsNCiAgICAgICAgICAgIGNoLnNlbmRUb1F1ZXVlKHEsIEJ1ZmZlci5mcm9tKG1zZykpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coIiBbeF0gU2VudCAnJXMnIiwgbXNnKTsNCiAgICAgICAgICAgIHJldHVybiBjaC5jbG9zZSgpOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9KQ0KICAgICAgICAuZmluYWxseShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgY29ubi5jbG9zZSgpOw0KICAgICAgICB9KTsNCiAgICB9KQ0KICAgIC5jYXRjaChjb25zb2xlLndhcm4pOw0KfQ0KDQpmdW5jdGlvbiBzZW5kX2xvZ3MobXNnKSB7DQogIHZhciBxID0gImlvdC9sb2dzIjsNCiAgYW1xcA0KICAgIC5jb25uZWN0KCJhbXFwOi8vZ3Vlc3Q6Z3Vlc3RAMTcyLjE4LjAuMjo1NjcyIikNCiAgICAudGhlbihmdW5jdGlvbiAoY29ubikgew0KICAgICAgcmV0dXJuIGNvbm4NCiAgICAgICAgLmNyZWF0ZUNoYW5uZWwoKQ0KICAgICAgICAudGhlbihmdW5jdGlvbiAoY2gpIHsNCiAgICAgICAgICB2YXIgb2sgPSBjaC5hc3NlcnRRdWV1ZShxLCB7IGR1cmFibGU6IGZhbHNlIH0pOw0KICAgICAgICAgIHJldHVybiBvay50aGVuKGZ1bmN0aW9uIChfcW9rKSB7DQogICAgICAgICAgICBjaC5zZW5kVG9RdWV1ZShxLCBCdWZmZXIuZnJvbShtc2cpKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCIgW3hdIFNlbnQgJyVzJyIsIG1zZyk7DQogICAgICAgICAgICByZXR1cm4gY2guY2xvc2UoKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSkNCiAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkgew0KICAgICAgICAgIGNvbm4uY2xvc2UoKTsNCiAgICAgICAgfSk7DQogICAgfSkNCiAgICAuY2F0Y2goY29uc29sZS53YXJuKTsNCn0NCg0KZnVuY3Rpb24gYmluMnN0cmluZyhhcnJheSkgew0KICB2YXIgcmVzdWx0ID0gIiI7DQogIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyArK2kpIHsNCiAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShhcnJheVtpXSk7DQogIH0NCiAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KZXhwb3J0cy5oYW5kbGVyID0gZnVuY3Rpb24gKGNvbnRleHQsIGV2ZW50KSB7DQogIHZhciBfZXZlbnQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGV2ZW50KSk7DQogIHZhciBfZGF0YSA9IGJpbjJzdHJpbmcoX2V2ZW50LmJvZHkuZGF0YSk7DQogIHZhciBsZXZlbCA9IHBhcnNlSW50KF9kYXRhKTsNCg0KICBsZXZlbCA8PSA1ID8gc2VuZF9hbGVydCgiIiArIGxldmVsKSA6IHNlbmRfbG9ncygiIiArIGxldmVsKTsNCg0KICBjb250ZXh0LmNhbGxiYWNrKCJTZW50IHdhdGVyIGxldmVsOiAiICsgbGV2ZWwpOw0KfTsNCg==
    commands:
      - 'npm install amqplib'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
  version: 1
